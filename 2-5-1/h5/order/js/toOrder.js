var checkin=parseInt(GetParams().checkin),checkout=parseInt(GetParams().checkout),roombook={productId:GetParams().id,checkin:checkin,checkout:checkout,quantity:1},productPrice,productPiontPrice,roomPayAmount,payPointAmounts,unitPrice,unitPricePoint,selectedCouponArray=[],nights,cashPointsPaymentInfo=0,canCashPoint=0,objectType,typeLast=[],cashPointsAmount,tolAmount,canBuyQuantity,maxBuyQuantity,priceType=0,buyPointsId,atidcode=[1,4,"52ac-f76d-804a-9f7c"],assetType,couponId,couponCode,payments,productInfo;void 0!=atidcode&&(assetType=GetParams().assettype?GetParams().assettype:GetParams().assetType,couponId=GetParams().couponid?GetParams().couponid:GetParams().couponId,couponCode=GetParams().couponcode?GetParams().couponcode:GetParams().couponCode,"undefined"==assetType&&(assetType=void 0),"undefined"==couponId&&(couponId=void 0),"undefined"==couponCode&&(couponCode=void 0)),-1!=location.href.indexOf("test.jihelife.com")&&(buyPointsId=51745),-1!=location.href.indexOf("api.jihelife.com")&&(buyPointsId=38607),$(document).ready(function(){function o(o){if(-1!=maxBuyQuantity){var t=GetParams().id,n="{'productIdList':["+t+"]}";$.post(h5orClient("/order/h5/count"),{data:n},function(n){var a=0;n.data[t].paidQuantity;return a="0"==n.sc&&void 0!=n.data[t].mypaidQuantity?parseInt(n.data[t].mypaidQuantity):0,canBuyQuantity=maxBuyQuantity-a,o>tolAmount&&-1!=tolAmount?void errorPrompt("商品库存不足",2e3):o>canBuyQuantity&&-1!=canBuyQuantity?void errorPrompt("每人最多可购买"+maxBuyQuantity+"份",2e3):(productPrice=floatFixed2(unitPrice*o),1==priceType&&(productPiontPrice=Math.round(unitPricePoint*o)),"0"==showCyType||"5"==showCyType?($("#virProPrice").html(showCyCode+Math.round(showTotalPrice*o)/100+showCyUnit),$("#principal").html(showCyCode+Math.round(showTotalPrice*o)/100+showCyUnit)):($("#virProPrice").html(showCyCode+Math.round(showTotalPrice*o)+showCyUnit),$("#principal").html(showCyCode+Math.round(showTotalPrice*o)+showCyUnit)),$("#rightsDiv .multiLine").each(function(){var e=$(this).index();$(".rightsUnit",this).html("￥"+floatFixed2(typeLast[e].serviceValue*o/100))}),roombook.quantity=o,roombook.paymentInfoList=selectedCouponArray,void e(roombook))})}else productPrice=floatFixed2(unitPrice*o),1==priceType&&(productPiontPrice=Math.round(unitPricePoint*o)),"0"==showCyType||"5"==showCyType?($("#virProPrice").html(showCyCode+Math.round(showTotalPrice*o)/100+showCyUnit),$("#principal").html(showCyCode+Math.round(showTotalPrice*o)/100+showCyUnit)):($("#virProPrice").html(showCyCode+Math.round(showTotalPrice*o)+showCyUnit),$("#principal").html(showCyCode+Math.round(showTotalPrice*o)+showCyUnit)),$("#rightsDiv .multiLine").each(function(){var e=$(this).index();$(".rightsUnit",this).html("￥"+floatFixed2(typeLast[e].serviceValue*o/100))}),roombook.quantity=o,roombook.paymentInfoList=selectedCouponArray,e(roombook)}function e(e,i){payments=[],void 0!=assetType&&(e.assetType=assetType),void 0!=couponId&&(e.couponId=couponId),void 0!=couponCode&&(e.couponCode=couponCode),e.productInfo=productInfo,void 0==e.checkin||null!=e.checkin&&!isNaN(e.checkin)||delete e.checkin,void 0==e.checkout||null!=e.checkout&&!isNaN(e.checkout)||delete e.checkout,$.post(h5orClient("/pay/h5/payable/booking"),{data:JSON.stringify(e)},function(e){if(0==e.sc){void 0!=e.data.cashPointsInfo&&void 0!=e.data.cashPointsInfo.paymentInfoList&&$("#switchOpen").hasClass("open")&&(payments=payments.concat(e.data.cashPointsInfo.paymentInfoList)),void 0!=e.data.couponInfo&&void 0!=e.data.couponInfo.paymentInfoList&&1==e.data.couponInfo.isSelected&&(payments=payments.concat(e.data.couponInfo.paymentInfoList)),void 0!=e.data.discountCouponInfo&&void 0!=e.data.discountCouponInfo.paymentInfoList&&1==e.data.discountCouponInfo.isSelected&&(payments=payments.concat(e.data.discountCouponInfo.paymentInfoList)),void 0!=e.data.roomPointsInfo&&void 0!=e.data.roomPointsInfo.paymentInfoList&&1==e.data.roomPointsInfo.isSelected&&(payments=payments.concat(e.data.roomPointsInfo.paymentInfoList)),void 0!=e.data.pointsFixedInfo&&1==e.data.pointsFixedInfo.isSelected&&void 0!=e.data.pointsFixedInfo.paymentInfoList&&(payments=payments.concat(e.data.pointsFixedInfo.paymentInfoList));var r=0;if(e.data.discountCouponInfo){r=parseInt(e.data.discountCouponInfo.selectedDiscountCouponValue?e.data.discountCouponInfo.selectedDiscountCouponValue:0);var c=e.data.discountCouponInfo.discountCouponDesc;$("#discountCouponInfo").html(c),-1!=c.indexOf("￥")?$("#discountCouponInfo").html(c).removeClass("paleRed"):$("#discountCouponInfo").html(c).addClass("paleRed")}else $("#discountCouponInfo").parents(".oneLine").hide();var d=0,u="";e.data.couponInfo?(1==e.data.couponInfo.isSelected&&($.each(e.data.couponInfo.paymentInfoList,function(o){for(var t=0,n={convert:e.data.couponInfo.paymentInfoList[o].convert,couponCode:e.data.couponInfo.paymentInfoList[o].couponCode,payType:e.data.couponInfo.paymentInfoList[o].payType},a=0;a<selectedCouponArray.length;a++)selectedCouponArray[a].couponCode==e.data.couponInfo.paymentInfoList[o].couponCode&&t++;0==t&&selectedCouponArray.push(n)}),a(".discListUl li",".choice"),a("#cashCouponUl li",".choice2"),a("#roomCouponUl li",".choice2"),$("#cashCouponUl li .choice2").hasClass("choosed")&&$("#cashVouchers").addClass("choosed"),$("#roomCouponUl li .choice2").hasClass("choosed")&&$("#roomVouchers").addClass("choosed"),s()),d=parseInt(e.data.couponInfo.selectedCouponValue?e.data.couponInfo.selectedCouponValue:0),u=e.data.couponInfo.couponDesc,/[0-9]/.test(u)?$("#couponInfo").html(u).removeClass("paleRed"):$("#couponInfo").html(u).addClass("paleRed")):$("#couponInfo").parents(".oneLine").hide();var p=0,l=0;if(e.data.roomPointsInfo?(l=parseInt(e.data.roomPointsInfo.amountByPointsExchange?e.data.roomPointsInfo.amountByPointsExchange:0),l>0?($("#integralToRoom").removeClass("no"),1==e.data.roomPointsInfo.isSelected?(p=l,$("#integralToRoom").addClass("choosed"),$("#roomPointsAmount").html("-￥"+p/100)):(t(),$("#integralToRoom").removeClass("choosed"),$("#roomPointsAmount").html(""))):$("#integralToRoom").addClass("no"),$("#roomPointsInfo").html(e.data.roomPointsInfo.pointsExchangeDesc)):$("#roomPointsInfo").parents(".oneLine").hide(),cashPointsAmount=0,e.data.cashPointsInfo?(canCashPoint=parseInt(e.data.cashPointsInfo.amountByPointsToCash?e.data.cashPointsInfo.amountByPointsToCash:0),$("#switchOpen").hasClass("open")?cashPointsAmount=canCashPoint:(cashPointsAmount=0,cashPointsPaymentInfo=0),$("#pointsToCashDesc").html(e.data.cashPointsInfo.pointsToCashDesc)):$("#pointsToCashDesc").parents(".oneLine").hide(),payPointAmounts=0,e.data.pointsFixedInfo?(1==e.data.pointsFixedInfo.isSelected&&(payPointAmounts=parseInt(e.data.pointsFixedInfo.pointsFixed?e.data.pointsFixedInfo.pointsFixed:0)),e.data.pointsFixedInfo.paymentInfoList?($("#buyPoints").hide(),$("#createandsubmit").removeClass("unSubmit")):$("#buyPoints").show().attr("href","/html/order/virtualGoods.html?mc=zqjf&id="+buyPointsId+"&needpoints="+productPiontPrice),$("#myPoints").html(e.data.pointsFixedInfo.pointsFixedDesc).parents(".oneLine").show()):$("#myPoints").parents(".oneLine").hide(),"none"==$("#discountCouponInfo").parents(".oneLine").css("display")&&"none"==$("#couponInfo").parents(".oneLine").css("display")&&"none"==$("#roomPointsInfo").parents(".oneLine").css("display")&&"none"==$("#pointsToCashDesc").parents(".oneLine").css("display")&&"none"==$("#myPoints").parents(".oneLine").css("display")&&$("#assets").hide(),1==priceType?(roomPayAmount=productPiontPrice-r-d-p-cashPointsAmount-payPointAmounts,roomPayAmount>0?$("#createandsubmit").addClass("unSubmit"):$("#createandsubmit").removeClass("unSubmit")):roomPayAmount=productPrice-r-d-p-cashPointsAmount-payPointAmounts,"first"==i){if(void 0!=e.data.discountCouponInfo&&e.data.discountCouponInfo.availableDiscountCouponPieces>0){for(var h=e.data.discountCouponInfo.discountCouponList,m="",y=0;y<h.length;y++){var C="choice discChoice",f=JSON.stringify(h[y].paymentInfo),P=JSON.stringify(h[y].rejectCouponCodes);void 0!==h[y].isSelected&&(C="choice discChoice choosed",selectedCouponArray.push(h[y].paymentInfo)),m+="<li value="+P+"><h2>"+h[y].couponBaseInfo.couponName+'</h2><span class="'+C+'"></span><span class="thisInfo" value='+f+"></span></li>"}$(".discListUl").html(m),$(".discListUl li").on("click",function(){delete roombook.defaultSelectDiscount,t(),$(".discListUl li .choice").removeClass("choosed"),$(this).find(".choice").addClass("choosed"),$(".windowBox,.underWindow,.upWindow").hide();var o=JSON.parse($(".thisInfo",this).attr("value")),e=[];void 0!=$(this).attr("value")&&"undefined"!=$(this).attr("value")&&(e=JSON.parse($(this).attr("value"))),n(o,e),s()})}if(void 0!=e.data.couponInfo&&void 0!=e.data.couponInfo.cashCouponList){for(var v=e.data.couponInfo.cashCouponList,I="",y=0;y<v.length;y++){var f=JSON.stringify(v[y].paymentInfo),P=JSON.stringify(v[y].rejectCouponCodes);I+="<li value="+P+'><p class="couponName">'+v[y].couponBaseInfo.couponName+"</p><p><i>有效期：</i>"+newFormatStrDate(new Date(parseInt(v[y].couponBaseInfo.effectiveTime)),"/")+" - "+newFormatStrDate(new Date(parseInt(v[y].couponBaseInfo.expireTime)),"/")+"</p><p><i>余额：</i><span>￥<em>"+v[y].remain/100+'</em></span></p><span class="choice2"></span><span class="thisInfo" value='+f+"></span></li>"}$("#cashCouponUl").html(I),$("#cashCouponUl li").on("click",function(){delete roombook.defaultSelectDiscount,t();var o=JSON.parse($(".thisInfo",this).attr("value")),e=[];void 0!=$(this).attr("value")&&"undefined"!=$(this).attr("value")&&(e=JSON.parse($(this).attr("value"))),$(".choice2",this).hasClass("choosed")?($(".choice2",this).removeClass("choosed"),n(o,e,"detele")):($(".choice2",this).addClass("choosed"),n(o,e)),$("#cashCouponUl li .choice2").hasClass("choosed")?$("#cashVouchers").addClass("choosed"):$("#cashVouchers").removeClass("choosed"),s()})}else $("#cashCouponUl").parents(".couponBox").hide();if(void 0!=e.data.couponInfo&&void 0!=e.data.couponInfo.roomCouponList){for(var w=e.data.couponInfo.roomCouponList,g="",y=0;y<w.length;y++){var f=JSON.stringify(w[y].paymentInfo),P=JSON.stringify(w[y].rejectCouponCodes);g+="<li value="+P+'><p class="couponName">'+w[y].couponBaseInfo.couponName+"</p><p><i>晚数：</i><span>"+w[y].couponBaseInfo.applyNights+'晚</span></p><span class="choice2"></span><span class="thisInfo" value='+f+"></span></li>"}$("#roomCouponUl").html(g),$("#roomCouponUl li").on("click",function(){delete roombook.defaultSelectDiscount,t();var o=JSON.parse($(".thisInfo",this).attr("value")),e=[];void 0!=$(this).attr("value")&&"undefined"!=$(this).attr("value")&&(e=JSON.parse($(this).attr("value"))),$(".choice2",this).hasClass("choosed")?($(".choice2",this).removeClass("choosed"),n(o,e,"detele")):($(".choice2",this).addClass("choosed"),n(o,e)),$(".cashCouponUl li .choice2").hasClass("choosed")?$("#roomVouchers").addClass("choosed"):$("#roomVouchers").removeClass("choosed"),s()})}else $("#roomCouponUl").parents(".couponBox").hide();if(void 0!=e.data.couponInfo&&1==e.data.couponInfo.isSelected&&(a(".discListUl li",".choice"),a("#cashCouponUl li",".choice2"),a("#roomCouponUl li",".choice2"),$("#cashCouponUl li .choice2").hasClass("choosed")&&$("#cashVouchers").addClass("choosed"),$("#roomCouponUl li .choice2").hasClass("choosed")&&$("#roomVouchers").addClass("choosed"),s()),buyPointsId==GetParams().id&&void 0!=GetParams().needpoints){var b=Math.ceil(GetParams().needpoints/100);$("#virProQuantity").val(b),o(b)}}1!=priceType||"4"!=showCyType&&"5"!=showCyType&&"1"!=showCyType?($("#roomPayAmount").html("￥"+roomPayAmount/100),$("#roomPrice").html(showCyCode+Math.round(showTotalPrice*roombook.quantity)/100+showCyUnit)):("5"==showCyType?$("#roomPrice").html(showCyCode+Math.round(showTotalPrice*roombook.quantity)/100+showCyUnit):$("#roomPrice").html(showCyCode+Math.round(showTotalPrice*roombook.quantity)+showCyUnit),$("#roomPayAmount").html("￥0").parents(".toOrderBtn").find(".hide").hide())}else errorPrompt(chinese(e.ErrorMsg),2e3)})}function t(){for(var o=0;o<selectedCouponArray.length;o++)if("3"==selectedCouponArray[o].payType){selectedCouponArray.splice(o,1),o-=1;break}}function n(o,t,n){var i=0;if("detele"==n){for(var r=0;r<selectedCouponArray.length;r++)if(o.couponCode==selectedCouponArray[r].couponCode){selectedCouponArray.splice(r,1),r-=1;break}}else{for(var r=0;r<selectedCouponArray.length;r++){o.couponCode==selectedCouponArray[r].couponCode&&(i=1);for(var c=0;c<t.length;c++)if(t[c]==selectedCouponArray[r].couponCode){selectedCouponArray.splice(r,1),r-=1;break}}0==i&&selectedCouponArray.push(o)}console.log(selectedCouponArray),roombook.paymentInfoList=selectedCouponArray,e(roombook),a(".discListUl li",".choice"),a("#cashCouponUl li",".choice2"),a("#roomCouponUl li",".choice2"),$("#cashCouponUl li .choice2").hasClass("choosed")||$("#cashVouchers").removeClass("choosed"),$("#roomCouponUl li .choice2").hasClass("choosed")||$("#roomVouchers").removeClass("choosed"),s()}function a(o,e){$(o).each(function(){var o=JSON.parse($(".thisInfo",this).attr("value"));0==selectedCouponArray.length&&$(e,this).removeClass("choosed");for(var t=0;t<selectedCouponArray.length;t++){if(o.couponCode==selectedCouponArray[t].couponCode){$(e,this).addClass("choosed");break}$(e,this).removeClass("choosed")}})}function s(){$("#cashCouponUl li .choice2").hasClass("choosed")||$("#roomCouponUl li .choice2").hasClass("choosed")?$("#coupSelected").addClass("choosed"):$("#coupSelected").removeClass("choosed")}function i(o){$(o).each(function(){for(var o=JSON.parse($(".thisInfo",this).attr("value")),e=0;e<selectedCouponArray.length;e++)if(o.couponCode==selectedCouponArray[e].couponCode){selectedCouponArray.splice(e,1),e-=1;break}})}function r(){var o={};$.post(h5orClient("/user/h5/info"),{data:JSON.stringify(o)},function(o){0==o.sc?1==o.data.memberFlag?($("#virCusName,#roomCusName").val(o.data.realname),$("#virCusPhone,#roomCusPhone").val(o.data.mobileAccount.accountName),$("#goReg").hide()):void 0==o.data.mobileAccount?($("#registerPhone").parents(".registerBox").show(),$("#registerCode").parents(".registerBox").show(),$("#registerName").parents(".registerBox").hide(),$("#goReg").show()):($("#registerPhone").parents(".registerBox").hide(),$("#registerCode").parents(".registerBox").hide(),$("#registerName").parents(".registerBox").show(),$("#registerBtn").html("绑定"),$("#goReg").show()):errorPrompt(chinese(assetsRes.ErrorMsg),2e3)})}function c(){if(0==d){d=60;var o={verifycodetype:0,accountname:$("#registerPhone").val()};$("#sendCode").addClass("unable");$.post(h5orClient("/user/h5/getverifycode"),{data:JSON.stringify(o)},function(o){if("0"!=o.sc)return errorPrompt(o.ErrorMsg,2e3),d=0,void $("#sendCode").removeClass("unable");$("#sendCode").html(d+"S");var e=setInterval(function(){d--,$("#sendCode").html(d+"S"),0==d&&($("#sendCode").html("重新发送").removeClass("unable"),clearInterval(e))},1e3)})}}1==sessionStorage.getItem("toOrderLeave")&&(sessionStorage.setItem("toOrderLeave",0),window.history.back()),function(){var o={id:GetParams().id,checkin:checkin,checkout:checkout};void 0!=assetType&&(o.assetType=assetType),void 0!=couponId&&(o.couponId=couponId),$.post(h5orClient("/product/h5/query"),{data:JSON.stringify(o)},function(o){if(0==o.sc){priceType=parseInt(o.data.productPrice.priceType?o.data.productPrice.priceType:o.data.priceType),maxBuyQuantity=parseInt(o.data.maxBuyQuantity),unitPrice=parseInt(o.data.productPrice.totalPrice),unitPricePoint=parseInt(o.data.productPrice.totalPointPrice?o.data.productPrice.totalPointPrice:0),productPrice=unitPrice,productPiontPrice=unitPricePoint,nights=parseInt((checkout-checkin)/24/3600/1e3),objectType=o.data.objectType,showCyCode=o.data.productPrice.showCyCode?o.data.productPrice.showCyCode:"",showCyUnit=o.data.productPrice.showCyUnit?o.data.productPrice.showCyUnit:"",showTotalPrice=o.data.productPrice.showTotalPrice?o.data.productPrice.showTotalPrice:0,showCyType=o.data.productPrice.showCyType?o.data.productPrice.showCyType:0;var t={priceType:priceType,totalPrice:o.data.productPrice.totalPrice,dailyPrice:o.data.productPrice.dailyPrice,totalPointPrice:o.data.productPrice.totalPointPrice,dailyPointPrice:o.data.productPrice.dailyPointPrice,pointPriceSrc:o.data.productPrice.pointPriceSrc,showCyType:o.data.productPrice.showCyType,showTotalPrice:o.data.productPrice.showTotalPrice,showCyUnit:o.data.productPrice.showCyUnit,showCyCode:o.data.productPrice.showCyCode};if(productInfo={hotelId:o.data.hotelId,productId:o.data.productId,productType:o.data.productType,cashExchFlag:o.data.cashExchFlag,payTypes:o.data.payTypes,pointPayTypes:o.data.pointPayTypes,productPrice:t,jiheBusinessMember:o.data.jiheBusinessMember},$("#roomProName").html(o.data.productName),$("#roomCheckIn").html(newFormatStrDateNoYear(new Date(checkin),"/")),$("#roomCheckOut").html(newFormatStrDateNoYear(new Date(checkout),"/")),$("#nights").html(nights),"31"==objectType||"30"==objectType||"40"==objectType){var n=o.data.serviceInfoList,r="";if("31"==objectType){$("#virtualPro,#fillProInfo,#lock,#rights,#assets,.hide").show(),$("#virSubHeading").html("您选择了众享方案");for(var c=0;void 0!=n&&c<n.length;c++)if("4"==n[c].type||"3"==n[c].type){for(var d=0,u=0;u<typeLast.length;u++)typeLast[u].type==n[c].type&&(typeLast[u].serviceValue=parseInt(typeLast[u].serviceValue)+parseInt(n[c].serviceValue),d++);0==d&&typeLast.push({type:n[c].type,serviceName:n[c].serviceName,serviceValue:n[c].serviceValue})}if(typeLast.length>0){for(var c=0;c<typeLast.length;c++)r+='<div class="clearfix multiLine"><div class="function gray fl"><span>'+typeLast[c].serviceName+'</span></div><div class="quota fr"><span class="rightsUnit">￥'+typeLast[c].serviceValue/100+"</span></div></div>";$("#rightsDiv").html(r)}else $("#rights").hide()}else $("#virtualPro,#fillProInfo,#assets,.hide").show();"40"==objectType&&$(".addressInfo").show(),$("#virProName").html(o.data.productName),1==priceType&&$(".hide").hide(),"0"==showCyType||"5"==showCyType?($("#virProUnit").html(showCyCode+Math.round(showTotalPrice)/100+showCyUnit),$("#virProPrice").html(showCyCode+Math.round(showTotalPrice*roombook.quantity)/100+showCyUnit),$("#principal").html(showCyCode+Math.round(showTotalPrice*roombook.quantity)/100+showCyUnit)):($("#virProUnit").html(showCyCode+Math.round(showTotalPrice)+showCyUnit),$("#virProPrice").html(showCyCode+Math.round(showTotalPrice*roombook.quantity)+showCyUnit),$("#principal").html(showCyCode+Math.round(showTotalPrice*roombook.quantity)+showCyUnit)),$("#lockTime").html(o.data.additionalInfo),roombook.paymentInfoList=selectedCouponArray,e(roombook,"first")}else{if($("#nonMember,#fillRoomInfo,#assets,.hide").show(),tolAmount=parseInt(o.data.tolAmount),void 0==o.data.tolAmount||1==o.data.tolAmount)$("#roomNumber").val("仅剩1间").attr("disabled","disabled");else{var p="";$("#roomNumber").val("1间");for(var c=1;c<=o.data.tolAmount&&c<=10;c++)p+="<li value='"+c+"'>"+c+"间</li>";$(".roomNumberUl").html(p)}roombook.paymentInfoList=selectedCouponArray,e(roombook,"first")}"0"==o.data.tolAmount&&$("#createandsubmit").addClass("unSubmit"),$(".roomNumberUl li").on("click",function(){$("#roomNumber").val($(this).html()),$(".windowBox,.underWindow,.upWindow").hide(),roombook.quantity=parseInt($(this).attr("value")),productPrice=unitPrice*roombook.quantity,productPiontPrice=unitPricePoint*roombook.quantity,$("#roomVouchers").removeClass("choosed"),i("#roomCouponUl li"),a("#roomCouponUl li",".choice2"),s(),roombook.paymentInfoList=selectedCouponArray,e(roombook)})}else errorPrompt(chinese(o.ErrorMsg),2e3)})}(),r(),$("#virProQuantity").val("1"),$(".mainContent").height($(window).height()),$("#sendCode").click(function(){c()}),$("#registerBtn").click(function(){if($("#registerBtn").addClass("no"),"注册"==$(this).html()){var o={accountname:$("#registerPhone").val(),verifycode:$("#registerCode").val()},e="/user/h5/bindmobile";if(""==$("#registerPhone").val()||""==$("#registerCode").val())return errorPrompt("手机号/验证码必填",2e3),void $("#registerBtn").removeClass("no");$.post(h5orClient(e),{data:JSON.stringify(o)},function(o){console.log(o),0==o.sc?r():errorPrompt(chinese("系统繁忙"),2e3),$("#registerBtn").removeClass("no")})}else if("绑定"==$(this).html()){var o={realname:$("#registerName").val()},e="/user/h5/registermember";if(""==$("#registerName").val())return errorPrompt("姓名必填",2e3),void $("#registerBtn").removeClass("no");$.post(h5orClient(e),{data:JSON.stringify(o)},function(o){0==o.sc?($(".windowBox,.upWindow").hide(),r()):errorPrompt(chinese("系统繁忙"),2e3),$("#registerBtn").removeClass("no")})}}),$("#clearDisc").click(function(){$(".discListUl li .choice").removeClass("choosed"),$(".windowBox,.underWindow,.upWindow").hide(),roombook.defaultSelectDiscount=0,i(".discListUl li"),a(".discListUl li",".choice"),s(),roombook.paymentInfoList=selectedCouponArray,e(roombook)}),$("#coupSelected").click(function(){0==$("#cashCouponUl li").length&&0==$("#roomCouponUl li").length||($(this).hasClass("choosed")?($(this).removeClass("choosed"),$("#cashVouchers,#roomVouchers").removeClass("choosed"),i("#cashCouponUl li"),a("#cashCouponUl li",".choice2"),i("#roomCouponUl li"),a("#roomCouponUl li",".choice2"),s(),roombook.paymentInfoList=selectedCouponArray,e(roombook)):$(".useCoupons").show())}),$("#cashVouchers").click(function(){$(this).hasClass("choosed")?($(this).removeClass("choosed"),i("#cashCouponUl li"),a("#cashCouponUl li",".choice2"),s(),roombook.paymentInfoList=selectedCouponArray,e(roombook)):($("#cashCouponUl").toggle(),$("#cashArrow").toggleClass("turnUp"))}),$("#roomVouchers").click(function(){$(this).hasClass("choosed")?($(this).removeClass("choosed"),i("#roomCouponUl li"),a("#roomCouponUl li",".choice2"),s(),roombook.paymentInfoList=selectedCouponArray,e(roombook)):($("#roomCouponUl").toggle(),$("#roomArrow").toggleClass("turnUp"))}),$("#integralToRoom").click(function(){selectedCouponArray=[],roombook.defaultSelectDiscount=0,$(this).hasClass("choosed")?roombook.paymentInfoList=[]:roombook.paymentInfoList=[{payType:"3"}],$(this).toggleClass("choosed"),$("#coupSelected,#cashVouchers,#roomVouchers").removeClass("choosed"),a(".discListUl li",".choice"),a("#cashCouponUl li",".choice2"),a("#roomCouponUl li",".choice2"),e(roombook)}),$("#switchOpen").click(function(){canCashPoint>0&&(delete roombook.defaultSelectDiscount,$(this).toggleClass("open"),e(roombook))}),$("#createandsubmit").click(function(){if($("#createandsubmit").addClass("no"),roomPayAmount>0&&"0"==priceType){var o=[{amount:roomPayAmount,paytype:0}];payments=payments.concat(o)}var e;if("31"==objectType||"30"==objectType||"40"==objectType){if(e={productid:GetParams().id,quantity:roombook.quantity,amount:productPrice,comments:$("#virRemarks").val(),payments:payments},1==priceType&&(delete e.amount,e.pointamount=productPiontPrice),"40"==objectType){if(""==$("#virCusName").val()||""==$("#virCusPhone").val()||""==$("#virCusAddress").val())return errorPrompt("收货信息不足",2e3),void $("#createandsubmit").removeClass("no");e.customeraddress=$("#virCusName").val()+","+$("#virCusPhone").val()+","+$("#virCusAddress").val()}}else e={productid:GetParams().id,customername:$("#roomCusName").val(),customermobile:$("#roomCusPhone").val(),checkin:roombook.checkin,checkout:roombook.checkout,quantity:roombook.quantity,amount:productPrice,comments:$("#roomRemarks").val(),payments:payments};1==priceType&&(delete e.amount,e.pointamount=productPiontPrice,e.assetType=assetType,e.couponId=couponId),e.productInfo=productInfo,$.post("/order/h5/createandsubmit",{data:JSON.stringify(e)},function(o){if(0==o.sc)sessionStorage.setItem("toOrderLeave",1),window.location.href="/html/h5/order/payment.html?orderid="+o.data.orderid;else{var e=o.ErrorMsg;-1!=e.indexOf("必须参数")&&(e="缺少信息"),errorPrompt(chinese(e),2e3)}$("#createandsubmit").removeClass("no")})}),$(".addBtn").on("touchstart",function(){var e=parseInt($("#virProQuantity").val())+1;$("#virProQuantity").val(e),o(e)}),$(".redBtn").on("touchstart",function(){var e=parseInt($("#virProQuantity").val())-1;e<1&&(e=1),$("#virProQuantity").val(e),o(e)}),$("#virProQuantity").focus(function(){$("#createandsubmit").addClass("no")}).blur(function(){o(parseInt($("#virProQuantity").val())),setTimeout(function(){$("#createandsubmit").removeClass("no")},1e3)}),$("#roomNumber").click(function(){$(".windowBox,#roomNumBox").show()}),$("#register").click(function(){$(".windowBox,.upWindow").show()}),$("#shadow").click(function(){$(".windowBox,.underWindow,.upWindow").hide()}),$("#myDisc").click(function(){0!=$(".discListUl li").length&&$(".windowBox,#discList").show()}),$("#myCoup").click(function(){0==$("#cashCouponUl li").length&&0==$("#roomCouponUl li").length||$(".useCoupons").show()}),$("#coupChoose").click(function(){$(".useCoupons").hide()}),$("#cashArrow").click(function(){$(this).toggleClass("turnUp"),$("#cashCouponUl").toggle()}),$("#roomArrow").click(function(){$(this).toggleClass("turnUp"),$("#roomCouponUl").toggle()});var d=0}),window.onload=function(){};