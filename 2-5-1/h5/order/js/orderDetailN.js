var orderUrl="/order/h5/info",orderData={orderid:GetParams().orderid},ua=window.navigator.userAgent.toLowerCase(),objectType,again=0,referrer=document.referrer;$(document).ready(function(){function e(){$.post(h5orClient(orderUrl),{data:JSON.stringify(orderData)},function(t){if(0==t.sc){objectType=t.data.objectType;var o,i=0,s=0,r=0,n=0,d=0,c=parseInt(t.data.countDown?t.data.countDown:0),l=parseInt(t.data.checkin),m=parseInt(t.data.checkout),h=t.data.nights?t.data.nights:1,f=t.data.quantity?t.data.quantity:1,u=t.data.payments;showCyType=t.data.showCyType,showCyCode=t.data.showCyCode?t.data.showCyCode:"",showCyUnit=t.data.showCyUnit?t.data.showCyUnit:"",showCyAmount=t.data.showCyAmount?t.data.showCyAmount:0,"0"!=showCyType&&"5"!=showCyType||(showCyAmount=t.data.showCyAmount/100);var p='<div class="clearfix multiLine" id="zgJia"><div class="function gray fl">总价：</div><div class="quota fr">'+showCyCode+showCyAmount+showCyUnit+"</div></div>";if($("#roomName").html(t.data.ordername),$("#checkIn").html(newFormatStrDateNoYear(new Date(l),"/")),$("#checkOut").html(newFormatStrDateNoYear(new Date(m),"/")),$("#nights").html(h),$("#quantity").html(f),$("#customerName").html(t.data.customerName),$("#customerMobile").html(t.data.customerMobile),$("#comments").html(t.data.comments),$("#countDown").html(a(c)),$("#orderid").html(GetParams().orderid),void 0!=t.data.customerAddress){var y=t.data.customerAddress;y=y.split(","),$("#customerName").html(y[0]),$("#customerMobile").html(y[1]),$("#customerAddress").html(y[2]).parents(".customerAddress").show()}if("31"==objectType||"30"==objectType||"40"==objectType||"99"==objectType?($(".bookingTips").html("").css("padding","0.5rem 1rem"),$("#checkTime,#hotelBox").hide()):"12"==objectType||void 0==objectType?($(".bookingTips").html("").css("padding","0.5rem 1rem"),$("#header,#customer").hide(),$("#hotelBox").show()):($(".bookingTips").html(t.data.cancelPolicy),$("#checkTime,#hotelBox").show()),c>0){$("#goOnPay").show(),$("#bottomFree").css("height","5.4rem");var v=setInterval(function(){c--,$("#countDown").html(a(c)),0==c&&($("#goOnPay").hide(),$("#bottomFree").css("height","2.4rem"),e(),clearInterval(v))},1e3)}else $("#goOnPay").hide(),$("#bottomFree").css("height","2.4rem");for(var w=0;void 0!=u&&w<u.length;w++)if(0==u[w].payType)i+=parseInt(u[w].amount);else if(1==u[w].payType||2==u[w].payType)s+=parseInt(u[w].amount);else if(3==u[w].payType)r+=parseInt(u[w].amount);else if(4==u[w].payType)n+=parseInt(u[w].amount);else if(5==u[w].payType||7==u[w].payType)d+=parseInt(u[w].amount);else if(6==u[w].payType)p+='<div class="clearfix multiLine2"><div class="function gray fl">积分：</div><div class="quota fr">积分'+u[w].faceValue+"个</div></div>";else if(11==u[w].payType){var g=u[w].faceValue;void 0==g&&(g=1),p+='<div class="clearfix multiLine"><div class="function gray fl">礼券：</div><div class="quota fr">'+u[w].couponAlias+g+"张</div></div>"}else 12==u[w].payType&&(p+='<div class="clearfix multiLine"><div class="function gray fl">礼券：</div><div class="quota fr">'+u[w].couponAlias+u[w].faceValue/100+"元</div></div>");switch(s>0&&(p+='<div class="clearfix multiLine"><div class="function gray fl">礼券：</div><div class="quota fr">-￥'+s/100+"</div></div>"),d>0&&(p+='<div class="clearfix multiLine"><div class="function gray fl">优惠券：</div><div class="quota fr">-￥'+d/100+"</div></div>"),r>0&&(p+='<div class="clearfix multiLine"><div class="function gray fl">积分兑房：</div><div class="quota fr">-￥'+r/100+"</div></div>"),n>0&&(p+='<div class="clearfix multiLine"><div class="function gray fl">积分抵现：</div><div class="quota fr">-￥'+n/100+"</div></div>"),i>0?($("#shouldPay").html("￥"+i/100),p+='<div class="clearfix multiLine"><div class="function gray fl"><span id="payNot">实付：</span></div><div class="quota <!--paleRed--> fr">￥'+i/100+"</div></div>"):0==i&&$("#shouldPay").html("￥"+i/100),$("#payInfoDiv").html(p),t.data.closereson?($("#nowStatus").html(t.data.statedesc+"("+t.data.closereson+")"),"待支付"==t.data.statedesc&&$("#payNot").html("应付：")):($("#nowStatus").html(t.data.statedesc),"待支付"==t.data.statedesc&&$("#payNot").html("应付：")),t.data.stateremark?$("#nowTips").html(t.data.stateremark):$("#nowTips").html(""),1==t.data.allowCancel?$("#cancelBtn").show():$("#cancelBtn").hide(),"1"==t.data.refundStatus?($("#nowTips").html("退款中"),$(".refundBox").show()):"9"==t.data.refundStatus?($("#nowTips").html("已退款"),$(".refundBox").hide()):$(".refundBox").hide(),t.data.status){case"5":case"8":case"11":case"12":o="&#xe610;";break;case"3":case"4":o="&#xe618;";break;default:o="&#xe60d;"}if($("#iconStatus").html(o),"&#xe618;"==o&&again<3&&setTimeout(function(){again++,e()},1500),"11"!=objectType&&"12"!=objectType&&void 0!=objectType||!t.data.hotelId)-1!=referrer.indexOf("myOrderList")||""==referrer?$("#productHref").attr("href","/html/order/virtualGoods.html?id="+t.data.productid).css("color","#000"):$("#productHref").attr("href","javascript:history.go(-1)").css("color","#000");else{var T='<div class="clearfix multiLine"><div class="function gray fl">支付方式：</div><div class="quota fr"><span>'+t.data.paydesc+"</span></div></div>";if(-1==$("#payInfoDiv").html().indexOf("支付方式")&&$("#zgJia").after(T),$("#productHref .arrowImg").hide(),t.data.paidTime){var C=newFormatStrDate(new Date(parseInt(t.data.paidTime)),"/"),I=timeFormatSecond(new Date(parseInt(t.data.paidTime)),":"),b='<div class="clearfix multiLine"><div class="function gray fl">支付时间：</div><div class="quota fr"><span>'+C+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+I+"</span></div></div>";-1==$("#orderidDiv").html().indexOf("支付时间")&&$("#orderidBox").before(b)}if(t.data.hotelId){var x={id:t.data.hotelId};$.post(h5orClient("/content/h5/hotel/detail"),{data:JSON.stringify(x)},function(e){if(0==e.sc){$("#address").html(e.data.hotelBaseInfo.address),$("#hotelCname").html(e.data.hotelBaseInfo.hotelCname),$("#hotelCname").parents(".hotelName").click(function(){window.location.href="/html/h5/product/detail/bnbShare.html?id="+x.id});var a=e.data.hotelBaseInfo.locLat,t=e.data.hotelBaseInfo.locLon,o=e.data.hotelBaseInfo.address,i=e.data.hotelBaseInfo.cityName;$("#navigation").attr("href","http://apis.map.qq.com/tools/poimarker?type=0&marker=coord:"+a+","+t+";title:"+i+";addr:"+o+";&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77&referer=myapp"),$("#hotelPhone").attr("href","tel://"+e.data.hotelBaseInfo.phone).html(e.data.hotelBaseInfo.phone)}})}}}else errorPrompt(chinese(t.ErrorMsg),2e3)})}function a(e){return minutes=parseInt(e/60),seconds=parseInt(e%60),formatNum(minutes)+":"+formatNum(seconds)}-1==referrer.indexOf("myOrderList")&&(sessionStorage.setItem("toOrderLeave",1),sessionStorage.setItem("paymentLeave",1)),$(".mainContent").height($(window).height()),e(),$("#cancel").click(function(){$("#cancel").addClass("no"),$(".mainContent,.cancelBox,.underWindow").hide();$.post(h5orClient("/order/h5/cancel"),{data:JSON.stringify(orderData)},function(a){0==a.sc?e():"-99999"!=a.sc?errorPrompt(a.ErrorMsg,2e3):errorPrompt(chinese("系统开小差了"),2e3),$("#cancel").removeClass("no")})}),$("#goOnPay").click(function(){sessionStorage.setItem("paymentLeave",0),window.location.href="/html/h5/order/payment.html?orderid="+orderData.orderid}),$("#cancelBtn").click(function(){$(".mainContent,.cancelBox").show()}),$(".refundBox").click(function(){$(".mainContent,.underWindow").show()}),$(".shadow,#wrong,#clearDisc").click(function(){$(".mainContent,.cancelBox,.underWindow").hide()})});